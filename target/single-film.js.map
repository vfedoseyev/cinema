{"version":3,"sources":["../js/single-film.js"],"names":["searchParams","URLSearchParams","location","search","filmId","get","likes","document","getElementById","stars","querySelectorAll","fetchKinopoiskFilmData","filmDetailsRequest","answer","json","filmData","data","header","description","posterImage","premiere","textContent","nameRu","src","posterUrl","premiereRu","fethcFilmMeta","fetch","body","views","ratingNumber","rating","ratings","reduce","a","b","parseInt","length","intRating","Math","round","isNaN","toFixed","forEach","star","i","classList","add","likeIcon","FILM_KEY","liked","localStorage","getItem","addEventListener","contains","setItem","likesCount","innerHTML","method","headers","$","on","JSON","stringify","dataset","value"],"mappings":"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","sourcesContent":["const searchParams = new URLSearchParams(location.search);\r\nconst filmId = searchParams.get('id');\r\n// нашли ID\r\n\r\nconst likes = document.getElementById('sf-likes');\r\nconst stars = document.querySelectorAll('.rt-star');\r\n\r\n\r\nconst fetchKinopoiskFilmData = async () => {\r\n    const answer = await filmDetailsRequest(filmId);\r\n    const {\r\n        data: filmData\r\n    } = await answer.json();\r\n    // получили детализацию о фильмах по ID \r\n\r\n    const header = document.getElementById('sf-header');\r\n    const description = document.getElementById('sf-desc');\r\n    const posterImage = document.getElementById('sf-poster');\r\n    const premiere = document.getElementById('sf-premiere');\r\n\r\n\r\n    header.textContent = filmData.nameRu;\r\n    description.textContent = filmData.description;\r\n    posterImage.src = filmData.posterUrl;\r\n    premiere.textContent = filmData.premiereRu;\r\n    // записали в разметку данные из детализации по фильмам\r\n};\r\n\r\nconst fethcFilmMeta = async () => {\r\n    const answer = await fetch(`http://inno-ijl.ru/multystub/stc-21-03/film/${filmId}`)\r\n    const {\r\n        body\r\n    } = await answer.json();\r\n    // запрос за др данными о лайках, просмотрах..\r\n\r\n    const views = document.getElementById('sf-views');\r\n    const ratingNumber = document.getElementById('sf-rating-number');\r\n\r\n    views.textContent = `${body.views} Views`;\r\n    likes.textContent = `${body.likes} Likes`;\r\n    // в разметку вписываем полученные данные с сервера\r\n\r\n    const rating = body.ratings.reduce((a, b) => parseInt(a) + parseInt(b), 0) / body.ratings.length;\r\n    // суммируем все полученные оценки и делим на длину, чтобы получить среднее\r\n    const intRating = Math.round(rating);\r\n    // округляем полученную оценку\r\n\r\n    if (isNaN(intRating)) {\r\n        ratingNumber.textContent = \"0.0\"\r\n        // если данных еще нет-прописываем 0,0\r\n    } else {\r\n        ratingNumber.textContent = rating.toFixed(1);\r\n        // расчет полученных данных с сервера\r\n    }\r\n    // TODO применить другой метод number tofixed\r\n\r\n    stars.forEach((star, i) => {\r\n        if (i < intRating) {\r\n            star.classList.add('star-selected')\r\n        };\r\n    })\r\n\r\n}\r\n// сравнение рейтинга и звездочек. Добавление класса звездочкам.\r\n\r\nconst likeIcon = document.getElementById(\"like-icon\");\r\nconst FILM_KEY = `film-${filmId}`;\r\nconst liked = localStorage.getItem(FILM_KEY);\r\nif (liked !== null) {\r\n    likeIcon.classList.add('like-icon__liked');\r\n}\r\n// проверяем добавлялся ли ранее лайк через localStorage\r\nlikeIcon.addEventListener(\"click\", () => {\r\n    if (!likeIcon.classList.contains('like-icon__liked')) {\r\n        localStorage.setItem(FILM_KEY, true)\r\n        // проверяем если нету класса like-icon__liked, то по клику добавляем в localStorage ключ и значение true\r\n        const likesCount = parseInt(likes.textContent, 10) + 1;\r\n        likes.innerHTML = `${likesCount} Likes`;\r\n        likeIcon.classList.add('like-icon__liked');\r\n\r\n        fetch(`http://inno-ijl.ru/multystub/stc-21-03/film/${filmId}/like`, {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json'\r\n            },\r\n        })\r\n    }\r\n})\r\n// отправили данные на сервер\r\n\r\n\r\n$('.rating_stars').on('click', '.rt-star', async function () {\r\n\r\n    await fetch(`http://inno-ijl.ru/multystub/stc-21-03/film/${filmId}/rating`, {\r\n        method: 'POST',\r\n        headers: {\r\n            'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify({\r\n            rating: +this.dataset.value\r\n        })\r\n    });\r\n    fethcFilmMeta();\r\n})\r\n// отправляем рейтинг звездочек на сервер\r\n\r\n\r\nfetchKinopoiskFilmData();\r\nfethcFilmMeta();"],"file":"single-film.js"}